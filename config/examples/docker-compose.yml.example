version: '3.8'
# Docker Compose configuration for multiple Dusk nodes
# This is a reference template - for production use, generate with generate-docker-compose.py

services:
  # Node 1 configuration
  dusk-node-1:
    build:
      context: .
      dockerfile: config/Dockerfile.runtime
      args:
        BASE_IMAGE: ubuntu:24.04
    container_name: dusk-node-1
    restart: unless-stopped
    ports:
      - "18001:8000"   # P2P port mapping
      - "19001:9000"   # RPC port mapping
    volumes:
      - dusk-node-1-data:/home/dusk/.dusk
      - dusk-node-1-rusk:/opt/dusk/rusk
    environment:
      - DUSK_NETWORK=mainnet
      - DUSK_FEATURE=default
      - DUSK_USER=dusk
      - RUST_LOG=info
    sysctls:
      - net.core.rmem_max=50000000
      - net.core.rmem_default=20000000
      - net.ipv4.udp_mem=262144 327680 393216
      - net.ipv4.udp_rmem_min=4096
      - net.core.netdev_max_backlog=2000
      - net.core.wmem_default=20000000
      - net.core.wmem_max=50000000
    # Resource limits
    cpu_limit: 1.0
    memory_limit: 2G
    storage_limit: 20G

  # Node 2 configuration
  dusk-node-2:
    build:
      context: .
      dockerfile: config/Dockerfile.runtime
      args:
        BASE_IMAGE: ubuntu:24.04
    container_name: dusk-node-2
    restart: unless-stopped
    ports:
      - "18082:8000"   # P2P port mapping
      - "19002:9000"   # RPC port mapping
    volumes:
      - dusk-node-2-data:/home/dusk/.dusk
      - dusk-node-2-rusk:/opt/dusk/rusk
    environment:
      - DUSK_NETWORK=mainnet
      - DUSK_FEATURE=default
      - DUSK_USER=dusk
      - RUST_LOG=info
    sysctls:
      - net.core.rmem_max=50000000
      - net.core.rmem_default=20000000
      - net.ipv4.udp_mem=262144 327680 393216
      - net.ipv4.udp_rmem_min=4096
      - net.core.netdev_max_backlog=2000
      - net.core.wmem_default=20000000
      - net.core.wmem_max=50000000
      cpu_limit: 1.0
      memory_limit: 2G
      storage_limit: 20G

volumes:
  dusk-node-1-data:
  dusk-node-1-rusk:
  dusk-node-2-data:
  dusk-node-2-rusk: